#!/bin/sh -eux

TARGET="$*"

#RUSTFLAGS="-C target-cpu=native" cargo build --release
# also accepts `dwarf'
#perf record --call-graph lbr target/release/world_demo

perf record --call-graph lbr -- $TARGET
perf script | inferno-collapse-perf > stacks.folded
cat stacks.folded | inferno-flamegraph > flamegraph.svg
